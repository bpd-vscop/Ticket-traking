@tailwind base;
@tailwind components;
@tailwind utilities;

/* ======================= THEME / BASE ======================= */
@layer base {
  :root {
    --background: 220 20% 98%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 222 47% 11%;
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 222 47% 11%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 222 47% 11%;
    --radius: 0.8rem;
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 210 40% 98%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 210 40% 98%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 210 40% 98%;
  }
}

@layer base {
  * {
    @apply border-border;
    box-sizing: border-box;
  }
  body {
    @apply bg-background text-foreground;
    font-feature-settings: "rlig" 1, "calt" 1;
  }
}

/* =================== REAL-SIZE / PREVIEW UTILITIES =================== */
@layer utilities {
  /* Exact sheet size in physical units (if you want a fixed-size element) */
  .sheet-297x420 {
    width: 29.7cm;
    height: 42cm;
    box-sizing: border-box;
  }

  /* Prevent flex/grid from shrinking the sheet */
  .sheet-noshrink {
    flex: 0 0 auto;
  }

  /* Scaled on-screen preview that keeps A3 ratio */
  .sheet-viewport {
    width: min(100%, 800px);
    aspect-ratio: 297 / 420;
    background: white;
    border: 1px solid hsl(var(--border));
    box-shadow: 0 1px 6px rgba(0,0,0,.06);
    box-sizing: border-box;
    margin-inline: auto;
  }

  /* Inner padding.
     For the preview we use UNIFORM margins (same top/bottom & left/right).
     0.5cm / 29.7cm = 1.6835% on x-axis. 0.5cm / 42cm = 1.19% on y-axis
  */
  .sheet-inner {
    width: 100%;
    height: 100%;
    padding: 1.19% 1.6835%;
    box-sizing: border-box;
  }

  .sheet-inner--even {
      padding: 1.5% !important;
  }

  /* Wrap that centers the grid inside the inner area */
  .sheet-grid-wrap {
    width: 100%;
    height: 100%;
    display: grid;
    place-items: center;
  }

  /* Grid that scales on screen with square cells.
     A3 paper with 4x4cm tickets = 7x10 grid. aspect-ratio: 7/10 */
  .grid-sheet {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    grid-template-rows: repeat(10, 1fr);
    gap: 0;
    width: 100%;
    aspect-ratio: 7 / 10;
    margin: 0 auto;
  }

  /* Ticket square (kept square in preview via grid-sheet aspect ratio) */
  .ticket {
    width: 100%;
    height: 100%;
    background: white;
    border: 1px dashed hsl(var(--border));
    display: flex;
    overflow: hidden;
  }

  /* Transparent background on blanks so the watermark shows through */
  .ticket--blank {
    background: transparent !important;
  }

  /* Left/Right panes with TRUE 80/20 split (borders/padding included) */
  .ticket__left,
  .ticket__right {
    box-sizing: border-box;
  }
  .ticket__left {
    flex: 0 0 80%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2%;
    border-right: 1px dashed hsl(var(--border));
  }
  .ticket__right {
    flex: 0 0 20%;
    background: #1f2937; /* slate-800 */
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.125rem;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    overflow: hidden;
  }

  /* Vertical code tuned to fit bar without clipping */
  .ticket__code {
    font-weight: 700;
    letter-spacing: .15em;
    writing-mode: vertical-rl;
    transform: rotate(180deg) scale(.4);
    line-height: 1;
    font-size: 1.5rem; /* ~text-2xl */
    white-space: nowrap;
  }
}

/* ============================ PRINT RULES ============================ */
@media print {
  @page {
    size: 29.7cm 42cm;
    margin: 0;
  }

  .sheet-viewport {
    width: 29.7cm !important;
    height: 42cm !important;
    aspect-ratio: auto;
    border: none;
    box-shadow: none;
  }

  /* Equal real margins for print too (0.5cm on all sides) */
  .sheet-inner {
    padding: 0.5cm !important;
  }

  /* Force exact 4cm cells for print */
  .grid-sheet {
    grid-template-columns: repeat(7, 4cm) !important;
    grid-template-rows: repeat(10, 4cm) !important;
    width: auto !important;
    aspect-ratio: auto !important;
  }

  .ticket {
    width: 4cm !important;
    height: 4cm !important;
  }

  img, svg, canvas {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* Ensure watermark prints */
  .paper-watermark::before {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
}

/* =================== HEXAGONAL WATERMARK (LOGO GRID) =================== */
@layer utilities {
  /* Attach this to the sheet inner container */
  .paper-watermark {
    position: relative;
    isolation: isolate;
    overflow: hidden;
    background: white;
  }

  .paper-watermark::before {
    content: "";
    position: absolute;
    inset: -40%;          /* overhang so it covers edges after rotation */
    z-index: -1;          /* behind tickets */
    pointer-events: none;

    /* Tunables */
    --wm-tile: 2cm;               /* horizontal step (controls spacing) */
    --wm-step-x: var(--wm-tile);  /* width of the repeating cell */
    --wm-step-y: calc(var(--wm-tile) * 0.8660254); /* âˆš3/2 for hex rows */
    --wm-rotate: -35deg;          /* diagonal angle */
    --wm-opacity: 0.12;           /* ~12% */

    /* Two staggered layers of the same logo to form a triangular lattice
       (hexagonal tiling points). Adjust --wm-tile for density. */
    background-image: url("/logo.svg"), url("/logo.svg");
    background-repeat: repeat, repeat;

    /* Repeat cell size (spacing between logos) */
    background-size:
      var(--wm-step-x) var(--wm-step-y),
      var(--wm-step-x) var(--wm-step-y);

    /* Second layer shifted by half step in both axes (creates hex grid) */
    background-position:
      0 0,
      calc(var(--wm-step-x) / 2) calc(var(--wm-step-y) / 2);

    opacity: var(--wm-opacity);
    transform: rotate(var(--wm-rotate));
    transform-origin: center;
    will-change: transform;
  }
}
